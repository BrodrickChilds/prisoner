(function(){var t,e,i,n,s,o;$(function(){return $("#game_user_tokens").tokenInput("/users.json",{crossDomain:!1,onAdd:i,hintText:"Type in a friend's name",tokenFormatter:function(t){return"<li><img src='"+t.url+"' title='"+t.name+"' height='25px' width='25px' />"+"<div style='display: inline-block; padding-left: 10px;'><div class='name'>"+t.name+"</div></div></li>"},resultsFormatter:function(t){return"<li><img src='"+t.url+"' title='"+t.name+"' height='25px' width='25px' />"+"<div style='display: inline-block; padding-left: 10px;'><div class='name'>"+t.name+"</div></div></li>"}}),$("a.random-request").click(n)}),n=function(t){return t.preventDefault(),$.ajax({url:$(this).attr("href"),data:null,dataType:"json",type:"GET",complete:function(t){var i;return i=JSON.parse(t.responseText),e(i.user.name,i.user.id,i.user.uid,i.url,i.show_info,i.last_five,i.time_left,i.send_reminder)}}),!1},i=function(){var t,i;return i=$("#game_user_tokens"),t=i.tokenInput("get"),i.tokenInput("clear"),$.ajax({url:"/users/"+t[0].id,data:null,dataType:"json",type:"get",complete:function(t){var i;return i=JSON.parse(t.responseText),e(i.user.name,i.user.id,i.user.uid,i.url,i.show_info,i.last_five,i.time_left,i.send_reminder)}})},e=function(e,i,n,s,o,a,r,l){var c,h,u,d,p,f,g;return d=$("<div class='game'></div>"),h=$("<div class='game-internal game-unit'></div>"),u=$("<div class='name'> </div>"),void 0===s?u.append(" "+e):(u.append("<img src="+s+">"),u.append(" "+e)),f=$("<div class='respond'></div>"),c=$("<a href=# class='game_respond light-link btn btn-danger cbutton ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only'></a>"),c.append("<span class='ui-button-text'>Betray</span>"),g=$("<a href=# class='game_respond light-link btn btn-success cbutton ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only'></a>"),g.append("<span class='ui-button-text'>Cooperate</span>"),f.append(g),f.append("<span> </span>"),f.append(c),p=$("<div class='recent-game-info'> </div>"),p.append("Time left in prison: "+r+" weeks </br> Betrayed opponents in "+a+"% of their last five games on this level"),h.append(u),o&&h.append(p),h.append(f),d.append(h),c.bind("click",function(){return t(h,"y",i,n,l)}),g.bind("click",function(){return t(h,"n",i,n,l)}),$(".pending-games").prepend(d)},t=function(t,e,i,n,o){var a,r;return o&&s(i,n),a=!1,r=$(".level").attr("id"),"y"===e&&(a=!0),$.ajax({url:"/games",data:{game:{user_id:String(i),opp_strat:a,stage_id:r}},dataType:"script",type:"POST",complete:function(e){var i,n;return t.hide(),n=$("<div> </div>"),n.append(e.responseText),t.parent().append(n),i=function(){return n.fadeOut("slow")},setTimeout(i,5e3)}}),!1},s=function(t,e){var i;return i=new Array(1),i.push(e),FB.ui({method:"apprequests",message:"You have a pending game in Prisoner's Dilemma!",to:i},o(t))},o=function(t){return $.ajax({url:"/users/"+t+"/update_reminder",dataType:"script",type:"PUT"}),function(){var t;return t=3}}}).call(this);